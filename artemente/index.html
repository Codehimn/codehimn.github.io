<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>¬°Rifa Artemente: Conecta con tu Energ√≠a Creativa!</title>
  <meta name="description" content="Rifa de un Kit Creativo-Consciente (camiseta, tula y sesi√≥n de yoga). Participa: juega el 7 de noviembre de 2025 con las 2 √∫ltimas cifras de la Loter√≠a de Medell√≠n. Publicaremos el n√∫mero ganador aqu√≠." />
  <style>
    :root{
      /* Colores inspirados en la paleta de Artemente y energ√≠a creativa */
      --bg: #f5f0fb; /* Fondo suave y claro */
      --card: #ffffff; /* Fondo de tarjeta blanco */
      --ink: #333333; /* Texto principal oscuro */
      --brand: #6a0572; /* Morado vibrante de Artemente */
      --muted: #8e44ad; /* Tono morado m√°s suave para texto secundario */
      --ok: #27ae60; /* Verde para acciones positivas (WhatsApp) */
      --warn: #e74c3c; /* Rojo para acciones de advertencia (restablecer) */
      --accent: #e0b0ff; /* Morado claro para acentos */
      --text-highlight: #4a005a; /* Morado oscuro para texto importante */
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;background:var(--bg);color:var(--ink)}
    header{background:linear-gradient(180deg, #ffffff, #ffffff00);position:sticky;top:0;z-index:10;border-bottom:1px solid #eee}
    .wrap{max-width:1000px;margin:auto;padding:20px}
    .hero{display:grid;grid-template-columns:1fr;gap:16px;align-items:center}
    .title{font-size:clamp(28px,5vw,48px);font-weight:800;color:var(--brand);letter-spacing:.4px}
    .tag{display:inline-block;background:var(--accent);padding:6px 12px;border-radius:999px;font-weight:600;color:var(--text-highlight);}
    .sub{color:var(--muted)}
    .card{background:var(--card);border:1px solid #eee;border-radius:18px;box-shadow:0 6px 24px rgba(0,0,0,.06)}
    .grid-card{padding:16px}
    .info{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .info b{color:var(--text-highlight)}
    .cta{display:flex;gap:12px;flex-wrap:wrap;margin-top:8px}
    .btn{border:none;cursor:pointer;padding:10px 14px;border-radius:12px;font-weight:700}
    .btn.primary{background:var(--brand);color:#fff}
    .btn.ghost{background:#0000;border:1px solid var(--muted);color:var(--ink)}
    .btn.ok{background:var(--ok);color:#fff}
    .btn.warn{background:var(--warn);color:#fff}

    .board{--cols:10;display:grid;grid-template-columns:repeat(var(--cols),1fr);gap:8px;margin-top:16px}
    .cell{position:relative;aspect-ratio:1;display:grid;place-items:center;border:1px solid #e5e5e5;border-radius:12px;background:#fff;font-weight:700;font-size:clamp(12px,2.8vw,18px);cursor:pointer;transition:.15s transform,.15s box-shadow}
    .cell:hover{transform:translateY(-1px);box-shadow:0 6px 16px rgba(0,0,0,.06)}
    .cell small{position:absolute;bottom:6px;right:8px;color:#aaa;font-weight:600;font-size:.75em}
    .cell.sold{color:#9b9b9b;opacity:.9}
    .cell.sold::after{content:"‚ú®";position:absolute;inset:0;display:grid;place-items:center;font-size:clamp(20px,4.8vw,30px)} /* Icono de brillo o estrella */
    .legend{display:flex;gap:14px;align-items:center;color:#666;font-size:14px}
    .dot{width:16px;height:16px;border-radius:6px;border:1px solid #ddd;background:#fff}
    .dot.sold{background:#f4f4f4;display:grid;place-items:center}
    .dot.sold::after{content:"‚ú®";font-size:12px} /* Icono de brillo o estrella para leyenda */

    figure{margin:0;border-radius:18px;overflow:hidden}
    img.hero-img{width:100%;height:auto;display:block}

    footer{padding:30px 20px;color:#666;text-align:center}
    .note{font-size:14px;color:var(--muted)}
    .winning-banner{margin-top:10px;padding:10px 14px;border-radius:12px;background:var(--accent);border:1px dashed var(--brand);color:var(--text-highlight)}

    @media (min-width:880px){
      .hero{grid-template-columns:1.15fr .85fr}
      .grid-card{padding:20px}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="info">
        <span class="tag">¬°Conecta con tu Energ√≠a Creativa!</span>
        <span class="sub">Juega el <b>7 de noviembre de 2025</b> con las <b>2 √∫ltimas cifras</b> de la Loter√≠a de Medell√≠n.</span>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <figure class="card">
        <img class="hero-img" src="artemente-rifa.jpg" alt="Kit Creativo Artemente en rifa" />
      </figure>

      <div class="grid-card card">
        <h1 class="title">G√°nate este Kit Creativo-Consciente Artemente</h1>
        <p class="sub">El ganador se llevar√°: <b>camiseta, tula y sesi√≥n de yoga con meditaci√≥n antiestr√©s</b>. ¬°Pocos cupos disponibles y mucha suerte! <b>Valor del n√∫mero: $10.000</b></p>
        <div class="legend" aria-hidden="true">
          <span class="dot"></span> Disponible
          <span class="dot sold"></span> Reservado
        </div>
        <div id="board" class="board" role="grid" aria-label="Cuadr√≠cula de la rifa (00 a 99)"></div>
        <div class="cta">
          <button id="btnWhats" class="btn ok">üì≤ Preguntar / Apartar por WhatsApp</button>
          <button id="btnInvert" class="btn ghost" title="Invierte selecci√≥n">Invertir selecci√≥n</button>
          <button id="btnReset" class="btn warn" title="Limpia todo">Restablecer</button>
        </div>
        <p class="note">Publicaremos aqu√≠ el <b>n√∫mero ganador</b> durante una semana despu√©s del sorteo. ‚úîÔ∏è</p>
        <div id="winning" class="winning-banner" hidden></div>
      </div>
    </section>
  </main>

  <footer>
    <small>Organiza: <b>Artemente</b>. Reglas: gana quien coincida con las 2 √∫ltimas cifras del premio mayor de la Loter√≠a de Medell√≠n del 7 de noviembre de 2025.</small>
  </footer>

  <script>
    // ================== CONFIGURACI√ìN R√ÅPIDA ==================
    // Reemplaza por tu n√∫mero de WhatsApp (con indicativo de pa√≠s):
    const WHATS_NUMBER = "573127302963"; // Ejemplo, ajusta si es diferente
    // Mensaje predeterminado para WhatsApp
    const WHATS_MSG = encodeURIComponent(
      "Hola üëã, quiero participar en la *Rifa Artemente*: Conecta con tu Energ√≠a Creativa. ¬øQu√© n√∫meros tienes disponibles?"
    );
    // ID de tu Google Sheet (aseg√∫rate de que sea p√∫blico o que la API de Google Sheets tenga permisos)
    const SHEET_ID = "1GxjtQxIKo0Z4YMQr09dNTQRIXET-iCT-IlEldU6cXsw";
    let disponibles = [];
    // ==========================================================

    const board = document.getElementById('board');

    // Carga/guarda estado local
    const save = () => localStorage.setItem('rifa-artemente-estado', JSON.stringify(state));
    const saved = localStorage.getItem('rifa-artemente-estado');

    // Estado: map n√∫mero -> sold(true/false)
    const state = saved ? JSON.parse(saved) : {};

    // Generar n√∫meros 00..99
    const numbers = Array.from({length:100}, (_,i)=> (""+i).padStart(2,'0'));

    async function cargarDisponibles() {
      try {
        const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&tq=select%20*`;
        const res = await fetch(url, { cache: "no-store" });
        const txt = await res.text();
        const json = JSON.parse(txt.substring(txt.indexOf("{"), txt.lastIndexOf("}") + 1));
        const rows = json.table.rows;

        disponibles = rows
          .map(r => r.c?.[0]?.v) // Asume que los n√∫meros est√°n en la primera columna (√≠ndice 0)
          .filter(v => v !== null && v !== undefined && v !== "" && String(v).toLowerCase() !== "numero") // Filtra celdas vac√≠as o el encabezado "numero"
          .map(v => String(v).padStart(2, "0")); // Formatea a dos d√≠gitos (ej. 7 -> "07")
        console.log("N√∫meros disponibles cargados:", disponibles);
      } catch (e) {
        console.error("No se pudo cargar el Sheet:", e);
        // Si hay un error, se inicializa disponibles como un array vac√≠o o un valor por defecto
        disponibles = [];
        alert("¬°Error al cargar los n√∫meros de la rifa! Intenta de nuevo m√°s tarde.");
      }
      render(); // Llama a render una vez que los datos se han cargado (o fallado)
    }

    function render(){
      board.innerHTML = '';
      numbers.forEach(num => {
        // Por defecto: reservado, salvo que est√© en 'disponibles' (cargado del Sheet)
        const defaultSold = !disponibles.includes(num);
        const sold = state[num] !== undefined ? state[num] : defaultSold;
        const cell = document.createElement('button');
        cell.className = 'cell' + (sold ? ' sold' : '');
        cell.setAttribute('role','gridcell');
        cell.setAttribute('aria-pressed', sold ? 'true' : 'false');
        cell.dataset.num = num;
        cell.innerHTML = `<div>${num}</div>`;
        cell.addEventListener('click', () => {
          // Solo permite marcar/desmarcar si el n√∫mero no es originalmente "vendido" por el Sheet
          if (disponibles.includes(num)) { // Solo se puede modificar si el n√∫mero est√° en la lista de disponibles del sheet
            state[num] = !cell.classList.contains('sold');
            save();
            render();
          } else {
            alert("Este n√∫mero ya est√° reservado o no est√° disponible.");
          }
        });
        board.appendChild(cell);
      });
    }

    // Botones
    document.getElementById('btnWhats').onclick = () => {
      // Prepara una lista de los n√∫meros seleccionados localmente
      const seleccionados = numbers.filter(num => state[num] === false && disponibles.includes(num)); // Los que el usuario marc√≥ como "disponibles" y que originalmente s√≠ lo estaban

      let whatsMessage;
      if (seleccionados.length > 0) {
        whatsMessage = encodeURIComponent(
          `Hola üëã, estoy interesado en reservar los siguientes n√∫meros para la *Rifa Artemente*: ${seleccionados.join(', ')}. ¬øEst√°n disponibles?`
        );
      } else {
        whatsMessage = WHATS_MSG; // Mensaje general si no ha seleccionado nada
      }

      const url = `https://api.whatsapp.com/send?phone=${WHATS_NUMBER}&text=${whatsMessage}`;
      window.open(url, '_blank');
    };

    document.getElementById('btnInvert').onclick = () => {
      // Al invertir, solo afecta los n√∫meros que originalmente est√°n en la lista de disponibles
      numbers.forEach(n => {
        if (disponibles.includes(n)) {
          state[n] = !(state[n] ?? (!disponibles.includes(n)));
        }
      });
      save(); render();
    };

    document.getElementById('btnReset').onclick = () => {
      if(confirm('¬øDesea restablecer el tablero al listado original (disponibles vs. reservados seg√∫n la hoja de c√°lculo)?')){
        localStorage.removeItem('rifa-artemente-estado');
        for (const k in state) delete state[k]; // Limpia el estado local
        render(); // Vuelve a renderizar con la data del Sheet
      }
    };

    // Mostrar ganador (si se pasa en el hash #ganador=NN)
    const params = new URLSearchParams(location.hash.slice(1));
    const ganador = params.get('ganador');
    if(ganador){
      const bn = ganador.padStart(2,'0');
      const winBox = document.getElementById('winning');
      winBox.hidden = false;
      winBox.textContent = `¬°Felicidades! El n√∫mero ganador es: ${bn}. Este aviso permanecer√° visible durante una semana.`;
    }

    // Inicia la carga de datos del Sheet
    cargarDisponibles();
  </script>
</body>
</html>